<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOVELVERSE</title>
    <!-- Importing a fantasy-appropriate font -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-ui: 'Inter', sans-serif;
            --font-reading: 'Merriweather', serif;
            --color-primary: #8a2be2; /* Blue Violet / Neon Purple */
            --color-accent: #00ffff; /* Neon Cyan */
            --color-gradient-start: #100b1a; /* Very dark purple/blue */
            --color-gradient-end: #1a0f30; /* Darker space purple */
            --glow-filter: drop_shadow(0 0 4px var(--color-accent)) drop-shadow(0 0 8px var(--color-primary));
            --blur: 10px;
            --bg-glass: rgba(255, 255, 255, 0.05);
            --border-glass: rgba(255, 255, 255, 0.1);

            /* Dark Mode Defaults */
            --color-text: #e0e7ff;
            --color-background: var(--color-gradient-start);
            --color-panel: #1a202c;
            --color-text-dim: #9ca3af;
        }

        .light-mode {
            --color-text: #1f2937;
            --color-background: #f0f4f8;
            --color-panel: #ffffff;
            --color-text-dim: #6b7280;
            --color-gradient-start: #e0e7ff; /* Light Blue */
            --color-gradient-end: #ffffff;
            --glow-filter: none;
            --bg-glass: rgba(240, 244, 248, 0.8);
            --border-glass: rgba(0, 0, 0, 0.1);
        }

        /* Base Styles & Transitions */
        body {
            font-family: var(--font-ui);
            margin: 0;
            padding: 0;
            color: var(--color-text);
            /* Updated background for deeper aesthetic */
            background: radial-gradient(circle at top left, var(--color-gradient-end) 0%, var(--color-gradient-start) 70%);
            min-height: 100vh;
            transition: all 0.5s ease;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        /* Glassmorphism Panel Base */
        .glass-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(var(--blur));
            border: 1px solid var(--border-glass);
            border-radius: 1rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            padding: 1.5rem;
            margin-bottom: 20px;
            transition: background 0.5s ease;
        }
        
        /* Aesthetic formatting for the system voice */
        .sage-voice {
            display: block;
            text-align: center;
            font-family: var(--font-ui);
            font-style: italic;
            font-weight: 700;
            color: var(--color-accent);
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.7);
            margin: 1.5rem 0;
            border-top: 1px solid var(--border-glass);
            border-bottom: 1px solid var(--border-glass);
            padding: 10px 0;
        }


        /* --- Header/Navigation --- */
        #nav-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 60px;
            padding: 0 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            background: var(--color-panel);
            transition: background 0.5s ease, opacity 0.3s;
        }

        .nav-item {
            font-weight: 700;
            color: var(--color-text-dim);
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: color 0.3s, background 0.3s;
        }

        .nav-item:hover {
            color: var(--color-text);
            background: rgba(var(--color-primary), 0.1);
        }
        
        .nav-item.active {
            color: var(--color-accent);
            text-shadow: 0 0 5px var(--color-accent);
        }

        /* --- Custom Button Style (Neon/Glow) --- */
        .neon-button {
            display: inline-block;
            padding: 1rem 3rem;
            margin: 1rem 0;
            border: 2px solid var(--color-primary);
            border-radius: 9999px;
            background: none;
            color: var(--color-text);
            font-size: 1.25rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 5px var(--color-primary), inset 0 0 5px var(--color-primary);
            transition: all 0.3s ease;
            filter: var(--glow-filter);
        }

        .neon-button:hover {
            background: var(--color-primary);
            color: var(--color-panel); /* Text color in dark mode */
            box-shadow: 0 0 10px var(--color-primary), 0 0 20px var(--color-primary), 0 0 30px var(--color-accent);
            transform: scale(1.05);
            filter: none;
        }
        
        /* --- Home Screen --- */
        #home-screen {
            height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            
            /* Enhanced background aesthetic */
            background-image: 
                radial-gradient(circle at 70% 30%, rgba(138, 43, 226, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 30% 70%, rgba(0, 255, 255, 0.1) 0%, transparent 50%);
            background-size: cover;
            background-position: center;
        }
        
        .logo-text {
            font-family: var(--font-reading);
            font-size: 4.5rem;
            font-weight: 700;
            color: var(--color-accent);
            /* Triple shadow for intense neon glow */
            text-shadow: 
                0 0 10px rgba(0, 255, 255, 0.8), 
                0 0 20px rgba(138, 43, 226, 0.8),
                0 0 30px rgba(0, 255, 255, 0.5);
            margin-bottom: 0.5rem;
            line-height: 1.1;
        }

        .hero-image {
            width: 80%;
            max-width: 450px;
            height: auto;
            border-radius: 1rem;
            margin: 2rem 0;
            /* Framed image with a slight glow */
            border: 4px solid var(--color-primary);
            box-shadow: 0 0 20px var(--color-primary);
            transition: transform 0.3s ease;
        }
        .hero-image:hover {
            transform: scale(1.03);
            box-shadow: 0 0 30px var(--color-accent);
        }

        /* --- Novel List Grid (formerly Volumes) --- */
        #volumes-screen, #characters-screen {
            padding-top: 80px; /* Space for fixed navbar */
            max-width: 1200px;
            width: 100%;
        }

        .volume-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .volume-card {
            cursor: pointer;
            text-align: center;
            padding: 1rem;
            transition: transform 0.3s, box-shadow 0.3s;
            background: var(--bg-glass);
            border-radius: 1rem;
            border: 1px solid var(--border-glass);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .volume-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5), 0 0 10px var(--color-accent);
        }

        .volume-cover {
            width: 100%;
            max-width: 180px;
            height: auto;
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            margin: 0 auto 10px auto;
        }
        
        /* --- Chapter List --- */
        #chapters-list {
            margin-top: 20px;
            width: 100%;
        }

        .chapter-item {
            cursor: pointer;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 0.75rem;
            background: var(--bg-glass);
            border-left: 5px solid var(--color-primary);
            transition: all 0.2s;
        }

        .chapter-item:hover {
            background: rgba(var(--color-primary), 0.1);
            transform: translateX(5px);
        }

        .chapter-item h4 {
            margin: 0 0 5px 0;
            color: var(--color-accent);
        }

        .chapter-item p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--color-text-dim);
        }

        /* --- Reader Interface --- */
        #reader-screen {
            padding-top: 80px;
            max-width: 800px;
            width: 100%;
        }

        #reading-panel {
            font-family: var(--font-reading);
            line-height: 1.8;
            padding: 2rem;
            min-height: 60vh;
            background: var(--color-panel);
            color: var(--color-text);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            transition: background 0.5s ease, color 0.5s ease;
            white-space: normal;
            overflow-y: scroll;
            position: relative;
        }

        #reading-panel p {
            margin-bottom: 1.2rem;
            text-indent: 1.5em; /* Standard novel indentation */
        }

        #reading-panel p:first-child {
            text-indent: 0; /* No indent on first paragraph */
        }
        
        /* Image within Reader Panel for illustrations */
        #reading-panel img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
            border-radius: 0.5rem;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        /* Page-flip/Fade Transition Effect */
        #reading-panel.page-fade {
            animation: fadein 0.8s ease-out;
        }
        @keyframes fadein {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #reader-content {
            transition: font-size 0.3s, line-height 0.3s;
        }

        /* Floating Nav Buttons */
        .reader-nav-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 900;
            display: flex;
            gap: 10px;
        }

        .reader-nav-btn {
            padding: 15px;
            background: var(--color-primary);
            color: var(--color-text);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--color-primary);
            transition: all 0.3s;
            filter: var(--glow-filter);
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .reader-nav-btn:hover {
            background: var(--color-accent);
            box-shadow: 0 0 15px var(--color-accent);
            transform: scale(1.1);
            filter: none;
        }

        /* Progress Bar */
        #progress-bar-container {
            width: 100%;
            height: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            margin-bottom: 1rem;
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background: var(--color-accent);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        /* Customization Panel */
        #settings-panel {
            max-width: 600px;
            width: 100%;
            padding-top: 80px;
        }

        .setting-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid var(--border-glass);
        }

        .setting-group label {
            font-weight: bold;
        }

        /* --- Floating Slime Icon (Decorative) --- */
        .slime-orb {
            position: fixed;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #00ffff, #00bfff);
            border-radius: 50%;
            box-shadow: 0 0 10px #00ffff, 0 0 20px #00bfff, 0 0 30px #00ffff;
            animation: float 6s ease-in-out infinite, pulse 2s infinite alternate;
            z-index: 5;
            pointer-events: none;
        }

        #slime-1 { top: 10%; left: 5%; animation-delay: 0s; }
        #slime-2 { top: 70%; right: 10%; animation-delay: 2s; width: 30px; height: 30px; }
        #slime-3 { bottom: 5%; left: 40%; animation-delay: 4s; }

        @keyframes float {
            0% { transform: translate(0, 0); }
            50% { transform: translate(10px, -20px); }
            100% { transform: translate(0, 0); }
        }
        @keyframes pulse {
            from { opacity: 0.6; }
            to { opacity: 1; }
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .logo-text { font-size: 2.5rem; }
            .neon-button { padding: 0.75rem 2rem; font-size: 1rem; }
            .volume-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
            .volume-cover { max-width: 100%; }
            .reader-nav-buttons { bottom: 10px; right: 10px; }
            .reader-nav-btn { width: 45px; height: 45px; padding: 10px; }
            #nav-bar { justify-content: space-around; padding: 0 10px; }
            .nav-item { padding: 0.5rem 0.5rem; }
            #reading-panel { padding: 1rem; }
        }
    </style>
</head>
<body>

    <!-- Decorative Slime Orbs -->
    <div class="slime-orb" id="slime-1"></div>
    <div class="slime-orb" id="slime-2"></div>
    <div class="slime-orb" id="slime-3"></div>

    <!-- Navigation Bar: Removed 'Characters' -->
    <div id="nav-bar" style="display: none;">
        <span class="nav-item" data-page="home">Home</span>
        <span class="nav-item active" data-page="volumes">Novel List</span>
        <span class="nav-item" data-page="settings">Settings</span>
    </div>

    <div id="app">
        <!-- Content will be rendered here by JavaScript -->
    </div>

    <script>
        // Content for the Prologue (Formatted with <p> and .sage-voice for aesthetics)
        const PROLOGUE_CONTENT = `
<p>It was just your typical kind of life. I graduated from college, landed a job at a sort-of-big general contractor outfit, and with my older brother taking care of our parents for me, I was currently enjoying all the myriad benefits of the bachelor-pad life. Age thirty-seven. No significant other.</p>

<p>I wasn’t exactly short or frumpy or hideous or anything. But when it came to the opposite sex, apparently I had nothing to offer. I’d made efforts along those lines, with varying degrees of dedication, but by the third rejection, something fizzled out within me. Besides— really, at this age, I was kinda past the point where a girlfriend needed to be my main focus. Work kept me busy enough. Plus, it wasn’t like I was gonna die without one.</p>

<p>…I’m not making excuses, all right? It’s just that I started thinking…</p>

<p>“Oh, hello, sir! Sorry we’re late!”</p>

<p>There he was, walking toward me, bursting with all that youthful energy of his. He and the beautiful woman next to him. His name was Tamura, one of the guys who worked under me, and she was Sawatari, the front-desk lady and pretty much the “it” girl around the office.</p>

<p>These bums asked to see me because they were getting married and wanted my advice. In other words, this meeting was the whole reason I was brooding over why I was such a failure at personal relationships. I was leaning against a telephone pole at the intersection where we’d agreed to meet after work, thinking to myself.</p>

<p>“Nah.” I nodded a greeting at Sawatari and asked, “What’d you want to talk about?”</p>

<p>“Oh, good to meet you. My name’s Miho Sawatari. I’ve seen you at work a lot, but…um, I guess this is the first time I’ve spoken to you, huh? It makes me kind of nervous, somehow.”</p>

<p><i>I’m the one who should be nervous, lady!</i> my mind griped to itself. <i>It’s not like I’m any good at speaking to women. How about a little sympathy here?</i></p>

<p>Any way you looked at it, I was the wrong person to ask. I knew nothing about love. They were doing this just to spite me—I was sure of it. Pretty sure, anyway.</p>

<p>“Oh, there’s nothing to be nervous about,” I replied. “Satoru Mikami. It’s good to meet you, Ms. Sawatari…although you’re famous enough around the office that you hardly need to even introduce yourself, huh? Tamura and I went to the same college, and we kind a hit it off during his training period, so that’s how we know each other.”</p>

<p>“Famous? Oof! Not famous in a weird way, I hope?”</p>

<p>“Oh, y’know. I hear stories about you dating Kameyama or messin’ around with Mr. Kihara in management…”</p>

<p>Somehow, I decided that picking on her would be a good idea. I just meant it as a passing joke, but it made Sawatari’s face turn a bright shade of red, her eyes watering up a bit. It was cute, in a way. People were always telling me to tone that stuff down—that I needed to consider people’s feelings more or, if not that, at least make it funnier—but I couldn’t help myself. So mark that down as another failure. Maybe I really do have a crap personality.</p>

<p>Tamura took that chance to intervene, giving Sawatari a pat on the shoulder. <i>Dammit, Tamura! So blessed with the natural charm you need to live a decent life… I wish people like you would just explode!</i></p>

<p>“Aw, stop being mean to her,” he admonished with an effortless smile. “And don’t worry, Miho, he’s just having a little fun with you.”</p>

<p>Cool, refreshing, and completely guileless—Tamura was impossible to hate. He was still just twenty-eight, quite a bit younger than I was, but we got on well nonetheless. I probably owed him at least a few congratulations…</p>

<p>“Hah, sorry,” I said, figuring there was no reason to let my jealousy devour me. “I can’t help but needle people like that sometimes. But no point standing here on the sidewalk. Wanna get something to eat while we talk?”</p>

<p>“Aaaahhh!!”</p>

<p>Screams. Chaos. <i>What is—What’s going on?!</i></p>

<p>“Move! I’ll kill you!!”</p>

<p>I turned around to find a man sprinting toward me, a backpack in one hand and a kitchen knife in the other. I could hear shrieking. He was coming my way. With a knife. A knife? And at the other end of it…</p>

<p>“Tamuraaaa!”</p>

<p>The moment I shoved Tamura aside, I felt a burning pain run across my back. My body balled up as it collapsed to the ground, trying to withstand the shock. I couldn’t tell what had happened. I wanted to move, but I couldn’t.</p>

<p>“Get the hell outta my way!” the man shouted as he ran off. I watched him go and then checked to see how my companions were. The suddenness of it all had reduced Tamura to a stupor, but he was unhurt. That was good.</p>

<p>But, man, was my back burning. So hot. Beyond anything I’d describe as pain. What’s up with that? It’s too hot… Gimme a break.</p>

<span class="sage-voice">Confirmed. Resist Heat…successfully acquired.</span>

<p>Did I… Did I just get stabbed?</p>

<p>So I’m gonna die from a stabbing? Holy crap…</p>

<span class="sage-voice">Confirmed. Resist Piercing Weapon…successfully acquired. Following up with Resist Melee Attack… Successfully acquired.</span>

<p>“M-Mr. Mikami, you’re bleeding…You won’t stop bleeding!”</p>

<p>I really didn’t need to hear that right now. Was that Tamura? I thought I heard some kind of weird voice. If it was Tamura, then so be it. <i>I’m bleeding? Well, duh. I’m only human. If you stab me, I’ll probably bleed all over you, yes.</i></p>

<p>Damn, this was starting to hurt, though…</p>

<span class="sage-voice">Confirmed. Cancel Pain…successfully acquired.</span>

<p>Um… Well, shit. All this pain and panic was starting to screw around with my consciousness.</p>

<p>“T-Tamura… Shut up. It… It’s nothing big, all right? Quit worrying…”</p>

<p>“Mr. Mikami, you’re… The blood…” Tamura tried to hold me up, face drained of color and looking about ready to break into sobs. So much for that bravado from two minutes ago. I tried to see how Sawatari was doing, but my vision was too fogged up to manage it.</p>

<p>Now the burning feeling on my back was starting to fizzle out. Instead, an intense, frigid cold was attacking me from head to toe. <i>That… That’s probably bad… People die once they bleed too much, don’t they?</i></p>

<span class="sage-voice">Confirmed. Constructing a blood-free body… Successful.</span>

<p>Hey, what’re you talking about? I can’t hear you too well…</p>

<p>I tried to speak. And failed.</p>

<p><i>Shit. I think this might really be it…</i> Like, the pain and the heat were pretty well gone by now. It was just cold. Cold as hell. I felt as if I was gonna freeze in place. Who knew dying could keep you so damn busy?</p>

<span class="sage-voice">Confirmed. Resist Cold…successfully acquired. Combined with the previously acquired Resist Heat, the skill has progressed to Resist Temperature.</span>

<p>Just then, what remained of my increasingly oxygen-deprived brain cells chanced upon a flash of brilliance. <i>Oh, craaaaap, the files on my hard drive!</i></p>

<p>I summoned up my remaining wells of strength, striving to relay the final regret I had left in life.</p>

<p>“Tamuraaa! If… If anything bad happens to me…take my computer, okay? Put it in the bathtub, turn it on, and just fry everything on the disk for me, man…”</p>

<span class="sage-voice">Confirmed. Electricity-based deletion of data… Cannot execute. More information required. Substituting with Resist Electricity… Successfully acquired.</span>

<p>It took a moment for my plea to register with Tamura. He gave me a blank stare. Then he snickered.</p>

<p>“Ha-ha! That’s just like you, isn’t it?”</p>

<p>Even if it was just a snicker, it beat having to depart this plane of existence with a grown man blubbering on top of me. I’d take it.</p>

<p>“All I wanted was to show Sawatari off to you, too…,” he continued. “Pfft…” <i>Hah. I knew it. That bastard.</i></p>

<p>“It’s fine, okay? Make her a happy woman.” I wrung out the last bit of strength my body had to offer. “Just kill my PC for me…”</p>

<div style="height: 2rem;"></div>

<p>It was just your typical kind of life. I graduated from college, landed a job at a sort-of-big general contractor outfit, and with my older brother taking care of our parents for me, I was currently enjoying all the myriad benefits of the bachelor-pad life. <b>And I was a virgin.</b></p>

<p><i>Imagine that. Floating off to meet my maker in completely unused condition… My manhood was probably crying its single eye out right then. Sorry I couldn’t make you a real grown-up. If there’s such a thing as reincarnation, I’m gonna go on the attack next time—I promise. I’ll hit up everyone I see, stalking my prey before I go in for the kill… Okay, not like that, but…</i></p>

<span class="sage-voice">Confirmed. Unique skill “Predator”…successfully acquired.</span>

<p>I mean, here I was, lookin’ at forty without ever losing my virginity. Like an old sage meditating in the mountains. Another few years, and I probably could’ve been the great sage of celibacy. Not the road I wanted to take in life, but there you go.</p>

<span class="sage-voice">Confirmed. Extra skill “Sage”…successfully acquired. Evolving extra skill “Sage” into unique skill “Great Sage”… Successful.</span>

<p><i>…Hey, someone mind telling me who’s talking? What do you mean, “unique skill ‘Great Sage’”? Someone tryin’ to start something with me? There’s nothing “unique” about that! If you think I’m finding that funny, I’m not! That’s just mean, man…</i></p>

<p>Before I could continue down that train of thought, however, I fell asleep.</p>

<p style="text-align: center; font-style: italic; margin-top: 3rem; font-size: 1.1em;">Weird how death’s nowhere near as lonely as I thought it’d be.</p>

<p style="text-align: center; font-style: italic; font-size: 0.9em; color: var(--color-text-dim);">That was the last thought I had on the mortal plane.</p>
        `;

        // Volume 1 Illustrations to be displayed on the Chapter List page
        const VOLUME_1_ILLUSTRATIONS = `
            <div style="text-align: center; margin-bottom: 2rem;">
                <h3 style="color: var(--color-accent); margin-bottom: 1rem; text-shadow: 0 0 3px var(--color-accent);">Prologue Illustrations</h3>
                <img src="https://i.imgur.com/4HpMSUD.jpeg" alt="Satoru Mikami being stabbed" loading="lazy" style="max-width: 90%; width: 400px; height: auto; margin-bottom: 1rem; border-radius: 0.5rem; box-shadow: 0 0 10px var(--color-primary);">
                <img src="https://i.imgur.com/6ol00al.jpeg" alt="The newly reincarnated Slime" loading="lazy" style="max-width: 90%; width: 400px; height: auto; border-radius: 0.5rem; box-shadow: 0 0 10px var(--color-primary);">
            </div>
        `;

        // --- UPDATED APP DATA ---
        const appData = {
            volumes: [
                // That Time I Reincarnated as a Slime
                { id: 1, title: "That Time I Reincarnated as a Slime", coverUrl: "https://i.imgur.com/2R8gdqp.jpeg", chapterCount: 1, preview: "The story of Satoru Mikami's reincarnation as the most powerful slime." },
                // Renamed 'Mune' to 'Re:Zero'
                { id: 50, title: "Re:Zero - Starting Life in Another World", coverUrl: "https://placehold.co/180x280/000080/ffffff?text=RE:ZERO", chapterCount: 0, preview: "A placeholder for the new series, Re:Zero." },
            ],
            // Only the Prologue remains active
            chapters: {
                'v1p0': { title: "Prologue: Death and Reincarnation", text: PROLOGUE_CONTENT, volumeId: 1, chapterIndex: 0 }, 
            },
            // 'characters' data has been REMOVED.
        };

        // --- GLOBAL STATE & UTILITIES ---
        const app = document.getElementById('app');
        const navBar = document.getElementById('nav-bar');
        let currentPage = 'home';
        let currentChapterKey = null;

        let settings = {
            theme: 'dark',
            fontSize: 18,
            lineSpacing: 1.8,
            lastChapterKey: null
        };

        const storageSafe = {
            set: (key, value) => { try { localStorage.setItem(key, value); } catch (e) { console.error("LocalStorage write failed:", e); } },
            get: (key) => { try { return localStorage.getItem(key); } catch (e) { console.error("LocalStorage read failed:", e); return null; } },
            parse: (key) => { try { const data = localStorage.getItem(key); return data ? JSON.parse(data) : null; } catch (e) { console.error("LocalStorage parse failed:", e); return null; } }
        };


        function loadSettings() {
            const storedSettings = storageSafe.parse('readerSettings');
            if (storedSettings) {
                settings = { ...settings, ...storedSettings };
            }
            applyTheme(settings.theme);
            currentChapterKey = settings.lastChapterKey;
        }

        function saveSettings() {
            storageSafe.set('readerSettings', JSON.stringify(settings));
        }

        function applyTheme(theme) {
            document.body.className = theme === 'light' ? 'light-mode' : '';
            settings.theme = theme;
            saveSettings();
        }

        function updateReaderStyle() {
            const panel = document.getElementById('reading-panel');
            if (panel) {
                const content = document.getElementById('reader-content');
                content.style.fontSize = `${settings.fontSize}px`;
                content.style.lineHeight = `${settings.lineSpacing}`;
            }
            if (currentPage === 'settings') {
                renderSettingsScreen();
            }
        }

        // --- NAVIGATION & ROUTING ---
        function navigate(page, data = null) {
            currentPage = page;
            app.innerHTML = '';
            navBar.style.display = (page === 'home') ? 'none' : 'flex';

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === page);
            });

            // Slime orbs visible only on secondary screens
            const slimeVisibility = (page !== 'home' && page !== 'reader') ? 'block' : 'none';
            document.querySelectorAll('.slime-orb').forEach(orb => orb.style.display = slimeVisibility);

            if (page === 'home') return renderHomeScreen();
            if (page === 'volumes') return renderVolumesScreen();
            if (page === 'chapters' && data && data.volumeId) return renderChapterList(data.volumeId);
            if (page === 'reader' && data && data.chapterKey) return renderReaderScreen(data.chapterKey);
            // Removed characters screen route
            if (page === 'settings') return renderSettingsScreen();
        }

        // --- RENDER FUNCTIONS ---

        function renderHomeScreen() {
            const lastChapterText = currentChapterKey ? `Continue Reading ${appData.chapters[currentChapterKey].title}` : 'Explore Novels';

            app.innerHTML = `
                <div id="home-screen">
                    <div>
                        <h1 class="logo-text">NOVELVERSE</h1>
                        <p style="color: var(--color-accent); font-size: 1.2rem; margin-top: -1rem; text-shadow: 0 0 5px var(--color-accent);">Your Gateway to Isekai and Fantasy</p>
                    </div>
                    
                    <!-- Updated Hero Image URL -->
                    <img src="https://i.imgur.com/DLA9p2u.jpeg" alt="Rimuru Tempest Hero" class="hero-image">

                    <button class="neon-button" onclick="navigate('volumes')">
                        ${lastChapterText}
                    </button>
                </div>
            `;
        }

        function renderVolumesScreen() {
            const volumesHtml = appData.volumes.map(vol => {
                let statusText;
                if (vol.chapterCount === 0) {
                    // Added "TO BE RELEASED" text for novels with 0 chapters
                    statusText = '<p style="font-size: 0.9rem; color: #ff4d4d; font-weight: bold; margin-top: 5px;">TO BE RELEASED</p>';
                } else {
                    statusText = `<p style="font-size: 0.8rem; color: var(--color-text-dim);">${vol.chapterCount} Chapters</p>`;
                }

                return `
                    <div class="volume-card glass-panel" onclick="navigate('chapters', {volumeId: ${vol.id}})">
                        <div>
                            <img src="${vol.coverUrl}" alt="${vol.title} Cover" class="volume-cover">
                            <h3>${vol.title}</h3>
                        </div>
                        ${statusText}
                    </div>
                `;
            }).join('');

            app.innerHTML = `
                <div id="volumes-screen">
                    <h2 style="text-align: center; margin-bottom: 30px; text-shadow: 0 0 5px var(--color-accent);">Novel List</h2>
                    <div class="volume-grid">
                        ${volumesHtml}
                    </div>
                </div>
            `;
        }

        function renderChapterList(volumeId) {
            const volume = appData.volumes.find(v => v.id === volumeId);
            if (!volume) { navigate('volumes'); return; }

            const chaptersInVolume = Object.entries(appData.chapters)
                .map(([key, chap]) => ({ key, ...chap })) 
                .filter(chap => chap.volumeId === volumeId)
                .sort((a, b) => a.chapterIndex - b.chapterIndex);

            let chaptersHtml;

            if (chaptersInVolume.length === 0) {
                 chaptersHtml = `<div style="text-align: center; padding: 30px; color: var(--color-text-dim);">
                                    <p>More chapters for <b>${volume.title}</b> coming soon!</p>
                                 </div>`;
            } else {
                 chaptersHtml = chaptersInVolume.map(chap => `
                    <div class="chapter-item" onclick="navigate('reader', {chapterKey: '${chap.key}'})">
                        <h4>${chap.title}</h4>
                        <p>${volume.preview}</p>
                        ${chap.key === currentChapterKey ? '<span style="color: var(--color-accent); font-weight: bold; font-size: 0.8rem;">(Last Read)</span>' : ''}
                    </div>
                `).join('');
            }
            
            // Inject illustrations only for Volume 1 (now just the Prologue)
            const illustrationInjection = volumeId === 1 ? VOLUME_1_ILLUSTRATIONS : '';

            app.innerHTML = `
                <div id="volumes-screen">
                    <h2 style="text-align: center; margin-bottom: 20px; text-shadow: 0 0 5px var(--color-primary);">${volume.title}</h2>
                    
                    ${illustrationInjection} <!-- Injected Prologue Illustrations -->

                    <div id="chapters-list">
                        ${chaptersHtml}
                    </div>
                </div>
            `;
        }
        
        function renderReaderScreen(chapterKey) {
            const chapter = appData.chapters[chapterKey];
            if (!chapter) { navigate('volumes'); return; }

            currentChapterKey = chapterKey;
            settings.lastChapterKey = chapterKey;
            saveSettings();

            app.innerHTML = `
                <div id="reader-screen">
                    <h2 style="text-align: center; color: var(--color-accent); margin-bottom: 20px; text-shadow: 0 0 3px var(--color-accent);">${chapter.title}</h2>
                    
                    <div id="progress-bar-container">
                        <div id="progress-bar"></div>
                    </div>

                    <div id="reading-panel" class="glass-panel page-fade">
                        <div id="reader-content">${chapter.text}</div>
                    </div>
                </div>
                
                <div class="reader-nav-buttons">
                    <button class="reader-nav-btn" onclick="goToPreviousChapter()">
                        &#9664; <!-- Left Arrow -->
                    </button>
                    <button class="reader-nav-btn" onclick="goToNextChapter()">
                        &#9654; <!-- Right Arrow -->
                    </button>
                </div>
            `;

            updateReaderStyle();
            
            // Add scroll listener for progress bar
            const panel = document.getElementById('reading-panel');
            panel.addEventListener('scroll', updateProgressBar);
            updateProgressBar(); // Initial call
        }
        
        // Removed renderCharactersScreen()

        function renderSettingsScreen() {
            // Re-render settings screen to show current values
            app.innerHTML = `
                <div id="settings-panel" class="glass-panel">
                    <h2 style="text-align: center; margin-bottom: 30px; color: var(--color-accent);">Reader Settings</h2>

                    <!-- Theme Toggle -->
                    <div class="setting-group">
                        <label>Theme</label>
                        <div>
                            <button class="neon-button" style="padding: 0.5rem 1rem; font-size: 1rem; margin: 0 5px;" 
                                onclick="applyTheme('dark')" 
                                ${settings.theme === 'dark' ? 'style="background: var(--color-primary);"' : ''}>Dark</button>
                            <button class="neon-button" style="padding: 0.5rem 1rem; font-size: 1rem; margin: 0 5px;" 
                                onclick="applyTheme('light')"
                                ${settings.theme === 'light' ? 'style="background: var(--color-primary);"' : ''}>Light</button>
                        </div>
                    </div>

                    <!-- Font Size -->
                    <div class="setting-group">
                        <label>Font Size: <span id="font-size-value">${settings.fontSize}px</span></label>
                        <input type="range" min="14" max="24" value="${settings.fontSize}" step="1" 
                               oninput="settings.fontSize = parseInt(this.value); document.getElementById('font-size-value').textContent = this.value + 'px'; updateReaderStyle(); saveSettings();">
                    </div>

                    <!-- Line Spacing -->
                    <div class="setting-group">
                        <label>Line Spacing: <span id="line-spacing-value">${settings.lineSpacing.toFixed(1)}</span></label>
                        <input type="range" min="1.0" max="2.5" value="${settings.lineSpacing}" step="0.1" 
                               oninput="settings.lineSpacing = parseFloat(this.value); document.getElementById('line-spacing-value').textContent = this.value; updateReaderStyle(); saveSettings();">
                    </div>

                    <p style="color: var(--color-text-dim); text-align: center; margin-top: 30px;">Settings will be applied to the Reader Interface.</p>
                </div>
            `;
        }

        // --- READER LOGIC (UNCHANGED) ---

        function updateProgressBar() {
            const panel = document.getElementById('reading-panel');
            const progressBar = document.getElementById('progress-bar');
            if (!panel || !progressBar) return;

            const scrollHeight = panel.scrollHeight - panel.clientHeight;
            const scrollPosition = panel.scrollTop;
            let progress = 0;

            if (scrollHeight > 0) {
                progress = (scrollPosition / scrollHeight) * 100;
            } else {
                progress = 100; // If content fits, show 100%
            }

            progressBar.style.width = `${progress}%`;
        }

        function getChapterNeighbors(currentKey) {
            const allChapters = Object.entries(appData.chapters)
                .map(([key, chap]) => ({ key, ...chap }))
                .sort((a, b) => {
                    // Sort by Volume ID first, then Chapter Index
                    if (a.volumeId !== b.volumeId) return a.volumeId - b.volumeId;
                    return a.chapterIndex - b.chapterIndex;
                });

            const currentIndex = allChapters.findIndex(chap => chap.key === currentKey);
            
            return {
                prev: currentIndex > 0 ? allChapters[currentIndex - 1].key : null,
                next: currentIndex < allChapters.length - 1 ? allChapters[currentIndex + 1].key : null,
            };
        }

        function goToPreviousChapter() {
            const neighbors = getChapterNeighbors(currentChapterKey);
            if (neighbors.prev) {
                const panel = document.getElementById('reading-panel');
                panel.classList.remove('page-fade');
                void panel.offsetWidth; // Trigger reflow
                navigate('reader', { chapterKey: neighbors.prev });
            } else {
                // Using console.log instead of alert per guidelines
                console.log("This is the first available chapter.");
            }
        }

        function goToNextChapter() {
            const neighbors = getChapterNeighbors(currentChapterKey);
            if (neighbors.next) {
                 const panel = document.getElementById('reading-panel');
                panel.classList.remove('page-fade');
                void panel.offsetWidth; // Trigger reflow
                navigate('reader', { chapterKey: neighbors.next });
            } else {
                console.log("End of current available content.");
            }
        }

        // --- INITIALIZATION ---
        function initApp() {
            loadSettings();

            // Set up Nav Bar listeners
            document.getElementById('nav-bar').addEventListener('click', (event) => {
                if (event.target.classList.contains('nav-item')) {
                    const page = event.target.dataset.page;
                    navigate(page);
                }
            });

            // Initial view
            navigate('home');
        }

        window.onload = initApp;
    </script>

</body>
</html>
